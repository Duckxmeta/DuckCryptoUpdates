<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Duck’s Crypto Updates | Just Duck It</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #1f2937;
      color: #e5e7eb;
    }
    h1, h2 {
      font-family: 'Arial', sans-serif;
      font-weight: bold;
    }
    .crypto-table, .events-table {
      background: #374151;
      border: 2px solid #facc15;
      border-radius: 0.375rem;
      padding: 0.5rem;
      margin-top: 0.5rem;
    }
    .crypto-table th, .crypto-table td, .events-table th, .events-table td {
      padding: 0.5rem;
      text-align: left;
      font-size: 0.875rem;
    }
    .crypto-table th, .events-table th {
      color: #facc15;
      font-weight: bold;
    }
    .crypto-table td, .events-table td {
      color: #e5e7eb;
    }
    .crypto-table tr.negative td {
      color: #f87171;
    }
    .crypto-table tr.positive td {
      color: #4ade80;
    }
    .crypto-table tr:hover, .events-table tr:hover {
      background: #4b5563;
    }
    .events-table .impact-high {
      color: #f87171;
    }
    .events-table .impact-medium {
      color: #facc15;
    }
    .events-table .impact-low {
      color: #4ade80;
    }
    .chatbot input {
      background-color: #4b5563;
      color: #e5e7eb;
      border: 1px solid #6b7280;
      border-radius: 0.375rem;
      padding: 0.5rem;
      font-size: 0.875rem;
    }
    .chatbot input:focus {
      outline: none;
      border-color: #facc15;
      box-shadow: 0 0 0 3px rgba(250, 204, 21, 0.3);
    }
    .chatbot button {
      background-color: #facc15;
      color: #1f2937;
      border: none;
      border-radius: 0.375rem;
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }
    .chatbot button:hover {
      background-color: #eab308;
    }
    .chatbot a {
      color: #facc15;
      text-decoration: underline;
    }
    .chatbot a:hover {
      color: #eab308;
    }
    .duck-animation {
      transition: transform 0.3s ease;
    }
    .duck-animation:hover {
      transform: scale(1.1);
    }
    .hero-gradient {
      background-image: radial-gradient(circle at center, #1f2937 0%, #ca8a04 100%);
    }
    @media (max-width: 640px) {
      .crypto-table th, .crypto-table td, .events-table th, .events-table td {
        font-size: 0.75rem;
        padding: 0.3rem;
      }
      .chatbot input, .chatbot button {
        font-size: 0.75rem;
        padding: 0.3rem;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="bg-yellow-400 text-white py-6">
    <div class="container mx-auto px-4 flex justify-between items-center">
      <h1 class="text-3xl font-bold">Duck’s Crypto Updates</h1>
      <a href="https://justduckit.org" class="text-white hover:text-gray-200">Back to Just Duck It</a>
    </div>
  </header>

  <!-- Main Content -->
  <section class="hero-gradient py-16 text-center">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold mb-4 text-gray-100">Crypto Market Updates</h2>
      <!-- Crypto Events Table -->
      <h2 class="text-2xl font-bold mt-8 mb-4 text-gray-100">Crypto Market Events</h2>
      <p class="text-lg max-w-xl mx-auto mb-6 text-gray-200">Track key events impacting crypto markets!</p>
      <div id="crypto-events" class="events-table mx-auto max-w-3xl">
        <table class="w-full">
          <thead>
            <tr>
              <th>Date</th>
              <th>Event</th>
              <th>Impact</th>
            </tr>
          </thead>
          <tbody id="events-table-body">
            <tr><td colspan="3" class="text-center">Loading crypto events...</td></tr>
          </tbody>
        </table>
      </div>
      <!-- Crypto Data Table -->
      <h2 class="text-2xl font-bold mt-8 mb-4 text-gray-100">Live Crypto Prices</h2>
      <p class="text-lg max-w-xl mx-auto mb-6 text-gray-200">Check the latest prices and market trends for top cryptocurrencies!</p>
      <div id="crypto-data" class="crypto-table mx-auto max-w-3xl">
        <table class="w-full">
          <thead>
            <tr>
              <th>Coin</th>
              <th>Price (USD)</th>
              <th>24h Change</th>
            </tr>
          </thead>
          <tbody id="crypto-table-body">
            <tr><td colspan="3" class="text-center">Loading crypto data...</td></tr>
          </tbody>
        </table>
      </div>
      <!-- Chatbot -->
      <div class="chatbot max-w-lg mx-auto mt-6">
        <p class="text-sm text-gray-200 mb-2">Type /help for available commands</p>
        <div id="chatbot-response" class="text-sm text-gray-200 mb-4 min-h-[2rem]"></div>
        <div class="flex gap-2">
          <input id="chatbot-input" type="text" placeholder="Ask about crypto (e.g., /info bitcoin or /info 3oqcUejEoAjGKcqBRs98XRmB4grsBk2rjjPZS7wEbonk)" class="w-full">
          <button id="chatbot-send" class="font-bold">Ask</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-yellow-400 text-white py-4 text-center">
    <p>© 2025 Just Duck It. All rights reserved.</p>
  </footer>

  <!-- JavaScript for CoinGecko API, CoinMarketCap API, Events, and Chatbot -->
  <script>
    // Fetch crypto data from CoinGecko for the table
    let cryptoData = [];
    async function fetchCryptoData() {
      const apiKey = 'CG-pkfUFyKVDwwGJtoRuzj4XPMo';
      const url = 'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=bitcoin,ethereum,binancecoin,solana,ripple&order=market_cap_desc&per_page=5&page=1&sparkline=false';
      try {
        const response = await fetch(url, {
          headers: {
            'Authorization': `Bearer ${apiKey}`
          }
        });
        if (!response.ok) throw new Error('API request failed');
        cryptoData = await response.json();
        const tableBody = document.getElementById('crypto-table-body');
        tableBody.innerHTML = '';
        cryptoData.forEach(coin => {
          const row = document.createElement('tr');
          row.className = coin.price_change_percentage_24h >= 0 ? 'positive' : 'negative';
          row.innerHTML = `
            <td>${coin.name}</td>
            <td>$${coin.current_price.toFixed(2)}</td>
            <td>${coin.price_change_percentage_24h.toFixed(2)}%</td>
          `;
          tableBody.appendChild(row);
        });
      } catch (error) {
        console.error('Error fetching crypto data:', error);
        document.getElementById('crypto-table-body').innerHTML = `
          <tr><td colspan="3" class="text-center">Quack! Data unavailable, try again soon.</td></tr>
        `;
      }
    }

    // Populate crypto events (static example data)
    function populateCryptoEvents() {
      const events = [
        { date: '2025-07-14', name: 'CLARITY Act Debate', impact: 'High', description: 'US Congress debates crypto regulations.' },
        { date: '2025-07-15', name: 'GENIUS Act Hearing', impact: 'High', description: 'Stablecoin regulation bill discussion.' },
        { date: '2025-07-16', name: 'Anti-CBDC Act Vote', impact: 'Medium', description: 'Vote on blocking US digital dollar.' },
        { date: '2025-07-20', name: 'Federal Reserve Rate Decision', impact: 'High', description: 'Potential impact on crypto prices.' },
        { date: '2025-07-22', name: 'Ethereum Network Upgrade', impact: 'Medium', description: 'Scheduled blockchain improvement.' }
      ];
      const tableBody = document.getElementById('events-table-body');
      tableBody.innerHTML = '';
      if (events.length > 0) {
        events.forEach(event => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${event.date}</td>
            <td>${event.name}</td>
            <td class="impact-${event.impact.toLowerCase()}">${event.impact}</td>
          `;
          tableBody.appendChild(row);
        });
      } else {
        tableBody.innerHTML = `
          <tr><td colspan="3" class="text-center">Quack! No events available, check back soon.</td></tr>
        `;
      }
    }

    // Chatbot logic with CoinMarketCap API
    async function handleChatbotQuery() {
      const input = document.getElementById('chatbot-input').value.toLowerCase().trim();
      const responseDiv = document.getElementById('chatbot-response');
      responseDiv.innerHTML = '';

      if (!input) {
        responseDiv.innerHTML = 'Quack! Please enter a query.';
        return;
      }

      // Handle /help command
      if (input === '/help') {
        responseDiv.innerHTML = `
          <strong>Available Commands:</strong><br>
          • /info [coin or contract address] - Get coin info: price, market cap, 24h change, contract address, age (e.g., /info bitcoin or /info 3oqcUejEoAjGKcqBRs98XRmB4grsBk2rjjPZS7wEbonk)<br>
          Try coins: bitcoin, ethereum, bnb, solana, ripple, or any valid contract address
        `;
        document.getElementById('chatbot-input').value = '';
        return;
      }

      // Supported blockchain platforms
      const platforms = [
        { id: 'solana', name: 'Solana', addressRegex: /^[1-9A-HJ-NP-Za-km-z]{42,44}$/ },
        { id: 'ethereum', name: 'Ethereum', addressRegex: /^0x[a-fA-F0-9]{40}$/ },
        { id: 'binance-smart-chain', name: 'BNB Chain', addressRegex: /^0x[a-fA-F0-9]{40}$/ }
      ];

      // Regex for API key-like input (UUID format)
      const apiKeyRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;

      // Hardcoded coins for quick name-based lookups
      const coins = {
        'bitcoin': { id: '1', slug: 'bitcoin', symbol: 'BTC', contract: 'N/A' },
        'ethereum': { id: '1027', slug: 'ethereum', symbol: 'ETH', contract: '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2' },
        'bnb': { id: '1839', slug: 'binance-coin', symbol: 'BNB', contract: '0xB8c77482e45F1F44dE1745F52C74426C631bDD52' },
        'solana': { id: '5426', slug: 'solana', symbol: 'SOL', contract: 'N/A' },
        'ripple': { id: '52', slug: 'xrp', symbol: 'XRP', contract: 'N/A' },
        'bonk': { id: '23095', slug: 'bonk', symbol: 'BONK', contract: '3oqcUejEoAjGKcqBRs98XRmB4grsBk2rjjPZS7wEbonk' }
      };

      let coinId = null;
      let slug = null;
      let symbol = null;
      let command = null;
      let contractAddress = null;
      let platformId = null;

      // Parse command and parameter
      if (input.startsWith('/')) {
        const [cmd, param] = input.split(' ');
        if (cmd === '/price' || cmd === '/change' || cmd === '/info') {
          command = cmd;
          if (param) {
            // Check if param looks like an API key
            if (apiKeyRegex.test(param)) {
              responseDiv.innerHTML = 'Quack! This looks like an API key, not a contract address. Please use a valid contract address (e.g., 3oqcUejEoAjGKcqBRs98XRmB4grsBk2rjjPZS7wEbonk).';
              document.getElementById('chatbot-input').value = '';
              return;
            }
            // Check if param is a contract address
            for (const platform of platforms) {
              if (platform.addressRegex.test(param)) {
                contractAddress = param;
                platformId = platform.id;
                break;
              }
            }
            // If not a contract address, check if it's a coin name or symbol
            if (!contractAddress) {
              for (const [name, data] of Object.entries(coins)) {
                if (param.includes(name) || param === data.symbol.toLowerCase()) {
                  coinId = data.id;
                  slug = data.slug;
                  symbol = data.symbol;
                  contractAddress = data.contract;
                  break;
                }
              }
            }
          }
        }
      } else {
        // Support natural language
        for (const [name, data] of Object.entries(coins)) {
          if (input.includes(name) || input.includes(data.symbol.toLowerCase())) {
            coinId = data.id;
            slug = data.slug;
            symbol = data.symbol;
            contractAddress = data.contract;
            command = input.includes('price') ? '/price' : input.includes('change') ? '/change' : input.includes('info') ? '/info' : null;
            break;
          }
        }
      }

      const cmcApiKey = '82a43fd4-88c5-434c-be76-c2d12f97c764';

      // Handle contract address lookup
      if (contractAddress && !coinId && platformId) {
        try {
          const response = await fetch(`https://pro-api.coinmarketcap.com/v1/cryptocurrency/map?CMC_PRO_API_KEY=${cmcApiKey}&contract_address=${contractAddress}&platform=${platformId}`);
          if (response.ok) {
            const data = await response.json();
            if (data.data && data.data.length > 0) {
              coinId = data.data[0].id.toString();
              slug = data.data[0].slug;
              symbol = data.data[0].symbol;
            } else {
              responseDiv.innerHTML = 'Quack! Invalid or unsupported contract address.';
              document.getElementById('chatbot-input').value = '';
              return;
            }
          } else {
            responseDiv.innerHTML = 'Quack! Error fetching contract data, try again soon.';
            document.getElementById('chatbot-input').value = '';
            return;
          }
        } catch (error) {
          console.error('Error fetching contract data:', error);
          responseDiv.innerHTML = 'Quack! Error fetching contract data, try again soon.';
          document.getElementById('chatbot-input').value = '';
          return;
        }
      }

      if (coinId && (command === '/price' || command === '/change' || command === '/info')) {
        try {
          const response = await fetch(`https://pro-api.coinmarketcap.com/v2/cryptocurrency/quotes/latest?id=${coinId}&CMC_PRO_API_KEY=${cmcApiKey}`);
          if (!response.ok) throw new Error('API request failed');
          const data = await response.json();
          const coin = data.data[coinId];
          const coinMarketCapLink = `<a href="https://coinmarketcap.com/currencies/${slug}/" target="_blank">View chart on CoinMarketCap</a>`;
          if (command === '/price') {
            responseDiv.innerHTML = `${coin.name} price: $${coin.quote.USD.price.toFixed(6)}<br>${coinMarketCapLink}`;
          } else if (command === '/change') {
            responseDiv.innerHTML = `${coin.name} 24h change: ${coin.quote.USD.percent_change_24h.toFixed(2)}%<br>${coinMarketCapLink}`;
          } else if (command === '/info') {
            const contract = contractAddress || coins[Object.keys(coins).find(key => coins[key].id === coinId)]?.contract || 'N/A';
            const coinAge = coin.date_added ? `Since ${new Date(coin.date_added).toLocaleDateString()}` : 'Not available via API';
            responseDiv.innerHTML = `
              <strong>${coin.name} (${coin.symbol}) Info:</strong><br>
              Price: $${coin.quote.USD.price.toFixed(6)}<br>
              Market Cap: $${coin.quote.USD.market_cap.toLocaleString()}<br>
              24h Change: ${coin.quote.USD.percent_change_24h.toFixed(2)}%<br>
              Contract Address: ${contract}<br>
              Coin Age: ${coinAge}<br>
              ${coinMarketCapLink}
            `;
          }
        } catch (error) {
          console.error('Error fetching coin info:', error);
          responseDiv.innerHTML = 'Quack! Data unavailable for this coin.';
        }
      } else {
        responseDiv.innerHTML = 'Quack! Try /help for available commands or ask about Bitcoin, Ethereum, etc. (e.g., /info bitcoin or /info 3oqcUejEoAjGKcqBRs98XRmB4grsBk2rjjPZS7wEbonk).';
      }

      document.getElementById('chatbot-input').value = '';
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      fetchCryptoData();
      populateCryptoEvents();
      document.getElementById('chatbot-send').addEventListener('click', handleChatbotQuery);
      document.getElementById('chatbot-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleChatbotQuery();
      });
    });
  </script>
</body>
</html>
